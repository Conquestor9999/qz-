
local Aiming = loadstring(game:HttpGet("https://raw.githubusercontent.com/Stefanuk12/Aiming/main/Load.lua"))()()
local AimingChecks = Aiming.Checks
local AimingSelected = Aiming.Selected

local function solve_travel_time(proj_pos, proj_speed, target, gravity)
    local diff = target - proj_pos
    local diffXZ = Vector3.new(diff.x, 0, diff.z)
    local groundDist = diffXZ.magnitude
    local speed2 = proj_speed * proj_speed
    local speed4 = speed2 * speed2
    local y = diff.y
    local x = groundDist
    local gx = gravity * x

	local root = speed4 - gravity * (gravity * x * x + 2 * y * speed2)
    if (root < 0) then
		return nil
	end
    root = math.sqrt(root)
    local sol = math.atan2(speed2 - root, gx)
    local bullet_direction = diffXZ.Unit * math.cos(sol) * proj_speed + Vector3.new(0, 1, 0) * math.sin(sol) * proj_speed
    local time = x / (math.cos(sol) * proj_speed)
    return bullet_direction, time
end

local function solve_prediction(part, time)
	local speed = part.AssemblyLinearVelocity
	local position = part.Position
	return position + speed * time
end

local player_list = getrenv()._G.PlayerList
local character_list = setmetatable({}, {
	__index = function(self, key)
		if player_list[key] then
			return player_list[key].Character
		end
	end
})

local players = game:GetService("Players")

local current_camera = workspace.CurrentCamera
local input_service = game:GetService("UserInputService")

local function vec3_to_vec2(vec3)
	return Vector2.new(vec3.X, vec3.Y)
end

local function get_closest()
	if AimingChecks.IsAvailable() == false then
		return nil, nil
	end

	return AimingSelected.Part, AimingSelected.Position
end

local red = Color3.new(1, 0, 0)
local green = Color3.new(0, 1, 0)
local lock_indicator = Drawing.new("Text")
lock_indicator.Outline = true
lock_indicator.Transparency = 1
lock_indicator.Color = red
lock_indicator.Center = true
lock_indicator.Text = "off"
lock_indicator.Visible = true

local target_indicator = Drawing.new("Circle")
target_indicator.Transparency = 1
target_indicator.Color = red
target_indicator.Thickness = 2
target_indicator.NumSides = 30
target_indicator.Radius = 3
target_indicator.Filled = true
target_indicator.Visible = false

local custom_camera = players.LocalPlayer.PlayerScripts.CustomCamera
local current_direction = custom_camera.CurrentDirection
local closest = get_closest()

input_service.InputBegan:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton2 then
		lock_indicator.Text = "on"
		lock_indicator.Color = green
	end
end)

input_service.InputEnded:Connect(function(input)
	if input.UserInputType == Enum.UserInputType.MouseButton2 then
		closest = nil
		lock_indicator.Text = "off"
		lock_indicator.Color = red
		target_indicator.Visible = false
	end
end)

game:GetService("RunService").RenderStepped:Connect(function()
	local viewport_half = (current_camera.ViewportSize / 2)
	lock_indicator.Position = viewport_half + Vector2.new(0, 50)
	if closest ~= nil and closest.Parent:FindFirstChild("Humanoid") and closest.Parent.Humanoid.Health ~= 0 then
		local cam_pos = current_camera.CFrame.Position
		lock_indicator.Text = ("locked on\n%dm"):format((cam_pos - closest.Position).Magnitude)
		target_indicator.Position = vec3_to_vec2(current_camera:WorldToViewportPoint(closest.Position))
		target_indicator.Visible = true
	elseif lock_indicator.Text == "on" then
		target_indicator.Visible = false
		closest = get_closest()
	end
end)

local index
index = hookmetamethod(game, "__index", function(self, key)
	if self == current_direction and key == "Value" then
		if closest ~= nil then
			local cam_pos = current_camera.CFrame.Position
			local _, time_nopredict = solve_travel_time(cam_pos, 2500, closest.Position, 100)
			local bullet_direction_predicted = solve_travel_time(cam_pos, 2500, solve_prediction(closest, time_nopredict), 100)
			return bullet_direction_predicted.Unit
		end
	end
	return index(self, key)
end)
local Material = loadstring(game:HttpGet("https://raw.githubusercontent.com/Kinlei/MaterialLua/master/Module.lua"))()
local AimingSettings = Aiming.Settings

local Library = Material.Load({
    Title = "sex",
    Style = 3,
    SizeX = 500,
    SizeY = 350,
    Theme = "Dark",
    ColorOverrides = {
        MainFrame = Color3.fromRGB(235,235,235)
    }
})

local AimingTab = Library.New({
    Title = "Aiming"
})

local TargetPart = AimingTab.TextField({
    Text = "Target Part"
})
AimingTab.Button({
    Text = "Add",
    Callback = function()
        if (table.find(AimingSettings.TargetPart, TargetPart:Get())) then
            Library.Banner({
                Text = "TargetPart already ignored"
            })
        end

        table.insert(AimingSettings.TargetPart, TargetPart:Get())
    end
})
AimingTab.Button({
    Text = "Remove",
    Callback = function()
        local I = table.find(AimingSettings.TargetPart, TargetPart:Get())
        if (not I) then
            Library.Banner({
                Text = "TargetPart not ignored"
            })
        end

        table.remove(AimingSettings.TargetPart, I)
    end
})
